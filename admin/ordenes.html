<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Órdenes y Stock</title>
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700&family=Pacifico&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="icon" type="image/png" href="../assets/img/logo.png">
</head>
<body>
    <script>
        const u = JSON.parse(localStorage.getItem('sessionUser')||'null');
        if (!u) { window.location.href = '../login.html'; }
        if (u && !['admin','vendedor'].includes(u.rol)) { window.location.href = 'index.html'; }
    </script>
    <header>
        <nav class="navbar navbar-expand-lg navbar-light" style="background-color: #FFF5E1;">
            <div class="container-fluid">
                <a class="navbar-brand" href="index.html">
                    <img src="../assets/img/logo.png" alt="Logo" width="32" height="32" class="d-inline-block align-text-top logo-svg">
                    Pastelería 1000 Sabores
                </a>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav ms-auto">
                        <li class="nav-item"><a class="nav-link" href="index.html">Panel</a></li>
                        <li class="nav-item"><a class="nav-link" href="../login.html" onclick="localStorage.removeItem('sessionUser')">Cerrar sesión</a></li>
                    </ul>
                </div>
            </div>
        </nav>
    </header>

    <main class="container mt-4">
        <h1 class="mb-4">Órdenes y Stock</h1>
        <div class="row g-4">
            <div class="col-lg-7">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title" style="color:#8B4513;">Órdenes realizadas</h5>
                        <div id="listaOrdenes"></div>
                    </div>
                </div>
            </div>
            <div class="col-lg-5">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title" style="color:#8B4513;">Stock de productos</h5>
                        <div id="listaStock"></div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer class="text-center mt-5">
        <p>&copy; 2025 Pastelería 1000 Sabores. Todos los derechos reservados.</p>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" defer></script>
    <script>
        function getOrders(){ return JSON.parse(localStorage.getItem('ordenes')||'[]'); }
        function getProducts(){ return JSON.parse(localStorage.getItem('productos')||'[]'); }

        // Render órdenes
        (function(){
            const cont = document.getElementById('listaOrdenes');
            const ordenes = getOrders();
            if (ordenes.length===0){
                cont.innerHTML = '<div class="alert alert-info">No hay órdenes registradas aún.</div>';
                return;
            }
            const frag = document.createDocumentFragment();
            ordenes.forEach(o=>{
                const div = document.createElement('div');
                div.className = 'border rounded p-3 mb-3';
                div.innerHTML = `
                    <div class="d-flex justify-content-between">
                        <div>
                            <strong>Orden #${o.id}</strong><br>
                            <span style="color:#5D4037;">Cliente: ${o.clienteCorreo}</span>
                        </div>
                        <div style="color:#8B4513; font-weight:bold;">$${o.total?.toLocaleString('es-CL')||0}</div>
                    </div>
                    <div class="mt-2" style="color:#5D4037;">
                        ${o.items.map(i=>`${i.codigo} - ${i.nombre} x${i.cantidad}`).join('<br>')}
                    </div>
                `;
                frag.appendChild(div);
            });
            cont.appendChild(frag);
        })();

        // Render stock
        (function(){
            const cont = document.getElementById('listaStock');
            const productos = getProducts();
            if (productos.length===0){
                cont.innerHTML = '<div class="alert alert-info">No hay productos cargados.</div>';
                return;
            }
            const ul = document.createElement('ul');
            ul.className = 'list-group';
            productos.forEach(p=>{
                const li = document.createElement('li');
                li.className = 'list-group-item d-flex justify-content-between align-items-center';
                li.innerHTML = `<span style="color:#5D4037;">${p.codigo} - ${p.nombre}</span><span class="badge" style="background-color:#8B4513;">${p.stock ?? '-'}</span>`;
                ul.appendChild(li);
            });
            cont.appendChild(ul);
        })();
    </script>
</body>
</html>


